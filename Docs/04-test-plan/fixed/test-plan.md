# テスト計画書

## 1. テスト方針

### 1.1 テストの目的

本プロジェクトのテストの主な目的は以下の通りです：

1. **バグの早期発見と修正**
   - 開発フェーズでのバグを早期に発見し、修正コストを削減
   - 品質の高いソフトウェアを提供

2. **品質の保証（リンク切れ調査の正確性）**
   - リンク切れ調査の正確性を保証
   - 誤検知・見逃しを防止
   - ユーザーが信頼できる結果を提供

### 1.2 テストの範囲

テストの対象範囲は以下の通りです：

#### 機能テスト
- **すべての機能**
  - URL入力機能
  - 調査開始・停止・一時停止・再開機能
  - 調査結果表示機能（一覧、詳細）
  - 設定機能（保存・読み込み）
  - 履歴機能（表示、選択）
  - エクスポート機能（CSV形式）

#### ビジネスロジックテスト
- **リンクチェック処理**
  - HTTPステータスコードによるリンク切れ判定
  - エラーハンドリング（タイムアウト、ネットワークエラー）
- **URL正規化処理**
  - 相対URLから絶対URLへの変換
  - URLの正規化（フラグメント削除、クエリパラメータ保持）
- **リンク抽出処理**
  - HTMLからのリンク抽出
  - 相対URL・絶対URLの抽出
- **並列処理制御**
  - 並列リクエスト数の制御
  - キューの管理
- **進捗計算**
  - 進捗率の計算
  - 統計情報の計算

#### UIコンポーネントテスト
- **すべての画面**
  - メイン画面（URL入力、調査開始）
  - 調査結果一覧画面（リスト表示、フィルタリング、検索）
  - 調査結果詳細画面（詳細情報表示）
  - 設定画面（設定項目の表示・編集）
  - 調査履歴画面（履歴一覧、選択）

#### IPC通信テスト
- **メインプロセスとレンダラープロセス間の通信**
  - すべてのIPC APIの動作確認
  - エラーハンドリング
  - 非同期処理の確認

#### データベース操作テスト
- **データの保存・取得**
  - 調査結果の保存
  - 調査履歴の保存
  - 設定の保存
- **検索・フィルタリング**
  - 調査結果の検索
  - フィルタリング（HTTPステータスコード、リンク切れ）
  - ソート機能
- **トランザクション処理**
  - データの整合性確認

#### HTTP通信テスト
- **外部サイトへのリクエスト**
  - 正常なURL（200 OK）
  - リンク切れURL（404、500など）
  - リダイレクトURL（301、302）
  - タイムアウト
  - ネットワークエラー
  - リトライ処理

#### エラーハンドリングテスト
- **各種エラーの処理**
  - ネットワークエラー
  - タイムアウト
  - HTTPエラー
  - データベースエラー
  - 入力検証エラー

#### パフォーマンステスト
- **大量データの処理**
  - 1000ページ、10000ページなど、様々な規模でのテスト
  - 処理時間の測定
  - メモリ使用量の測定
  - UI応答性の確認

#### セキュリティテスト
- **入力検証**
  - URLバリデーション
  - SQLインジェクション対策
  - XSS対策
  - パストラバーサル対策

### 1.3 テストの除外範囲

特に除外範囲はありません。すべての機能・コンポーネントをテスト対象とします。

### 1.4 テストの基本方針

テストを実施する際の基本方針は以下の通りです：

1. **テストカバレッジを重視**
   - 全体のカバレッジ目標: 80%以上
   - ビジネスロジック: 90%以上
   - データアクセス層: 80%以上
   - UIコンポーネント: 70%以上

2. **自動テストを優先**
   - 単体テスト、結合テスト、E2Eテストは自動化
   - 手動テストは最小限（UIの見た目確認など）

3. **段階的なテスト**
   - 単体テスト → 結合テスト → システムテスト → E2Eテストの順で実施
   - 各段階で問題を発見・修正してから次の段階に進む

4. **継続的テスト（CI/CDでの自動実行）**
   - コミット時に単体テストを自動実行
   - プルリクエスト時にすべてのテストを自動実行
   - リリース前にすべてのテスト + E2Eテストを実行

## 2. テスト種別

### 2.1 単体テスト

#### 目的
- 個々の関数・メソッド・クラスが正しく動作することを確認
- ビジネスロジックの正確性を保証
- バグの早期発見

#### 対象
- **ビジネスロジック**
  - LinkCheckerクラス（リンクチェック、リンク抽出）
  - URL正規化ロジック
  - リンク切れ判定ロジック
  - URLフィルタリングロジック
  - 進捗計算ロジック
  - 統計情報計算ロジック
- **データアクセス層**
  - ScanHistoryModel
  - LinkCheckResultModel
  - SettingsModel
- **ユーティリティ**
  - URLバリデーション
  - エラーハンドリング

#### 実施方法
- **テストフレームワーク**: Jest
- **テスト実行**: `npm test`
- **カバレッジ測定**: `npm run test:coverage`
- **モック**: 外部依存（HTTPリクエスト、データベース）をモック化

#### 判定基準
- すべてのテストケースがパスする
- カバレッジが目標値（ビジネスロジック: 90%以上、全体: 80%以上）を達成
- エッジケースも含めてテストされている

### 2.2 結合テスト

#### 目的
- 複数のコンポーネントが連携して正しく動作することを確認
- IPC通信、データベース連携、HTTP通信の動作確認

#### 対象
- **IPC通信**
  - レンダラープロセスとメインプロセス間の通信
  - 各IPC APIの動作確認
- **データベース連携**
  - データの保存・取得
  - トランザクション処理
- **HTTP通信**
  - 外部サイトへのリクエスト
  - エラーハンドリング

#### 実施方法
- **テストフレームワーク**: Jest
- **テスト実行**: `npm run test:integration`
- **テスト環境**: テスト用のSQLiteデータベース、モックサーバー

#### 判定基準
- すべてのテストシナリオがパスする
- データの整合性が保たれている
- エラーハンドリングが正しく動作する

### 2.3 システムテスト

#### 目的
- システム全体が正しく動作することを確認
- エンドツーエンドの機能を確認

#### 対象
- **主要なユーザーフロー**
  - URL入力 → 調査開始 → 結果表示
  - 設定変更 → 保存
  - 履歴選択 → 結果表示
  - 調査の一時停止・再開
  - 調査結果のフィルタリング・検索
  - エクスポート機能

#### 実施方法
- **テストフレームワーク**: Jest + Electron Test Utils
- **テスト実行**: `npm run test:system`
- **テスト環境**: 実際のElectronアプリケーション環境

#### 判定基準
- すべてのユーザーフローが正常に動作する
- エラーが発生しない
- 期待通りの結果が得られる

### 2.4 E2Eテスト

#### 目的
- 実際のユーザー操作をシミュレートして、システム全体の動作を確認
- UIとバックエンドの統合動作を確認

#### 対象
- **主要なユーザーフロー**
  - アプリケーション起動
  - URL入力・調査開始
  - 設定変更
  - 履歴表示

#### 実施方法
- **テストツール**: Playwright または Spectron
- **テスト実行**: `npm run test:e2e`
- **テスト環境**: 実際のElectronアプリケーション環境

#### 判定基準
- すべてのE2Eテストシナリオがパスする
- UIが正しく表示される
- ユーザー操作が正しく動作する

### 2.5 パフォーマンステスト

#### 目的
- 大量データを処理した場合のパフォーマンスを確認
- ボトルネックを特定
- パフォーマンス要件を満たしていることを確認

#### 対象
- **調査処理**
  - 大量のURLを調査した場合のパフォーマンス
  - 並列処理の効果
- **データベースクエリ**
  - 大量データの検索・フィルタリング
- **UI応答性**
  - 大量データの表示時のUI応答性

#### 実施方法
- **テスト方法**: 負荷テスト（1000ページ、10000ページなど）
- **測定項目**: 処理時間、メモリ使用量
- **ツール**: プロファイリングツール（Chrome DevTools、Node.js Profiler）

#### 判定基準
- パフォーマンス要件を満たしている
- メモリリークが発生していない
- UIがフリーズしない

### 2.6 セキュリティテスト

#### 目的
- セキュリティ要件を満たしていることを確認
- 脆弱性を発見・修正

#### 対象
- **入力検証**
  - URLバリデーション
  - SQLインジェクション対策
  - XSS対策
  - パストラバーサル対策

#### 実施方法
- **テスト方法**: ペネトレーションテスト
- **テストツール**: 手動テスト + 自動テスト

#### 判定基準
- セキュリティ要件を満たしている
- 既知の脆弱性が存在しない

### 2.7 ユーザビリティテスト

#### 目的
- UIの使いやすさを確認
- ユーザー体験を向上

#### 対象
- **すべての画面**
  - メイン画面
  - 調査結果一覧画面
  - 調査結果詳細画面
  - 設定画面
  - 調査履歴画面

#### 実施方法
- **テスト方法**: 手動テスト
- **テスト観点**: 操作性、視認性、エラーメッセージの分かりやすさ

#### 判定基準
- UIが直感的に操作できる
- エラーメッセージが分かりやすい
- ユーザーが迷わず操作できる

## 3. テスト項目

### 3.1 機能テスト項目

#### 3.1.1 URL入力機能
- [ ] 正常なURLを入力できる
- [ ] 無効なURLを入力した場合、エラーメッセージが表示される
- [ ] URLバリデーションが正しく動作する
- [ ] 入力したURLが正しく保存される

#### 3.1.2 調査開始機能
- [ ] 調査を開始できる
- [ ] 調査開始時に進捗が表示される
- [ ] 調査中に統計情報が更新される
- [ ] 調査完了時に結果が表示される

#### 3.1.3 調査停止機能
- [ ] 調査を停止できる
- [ ] 停止時に進行中のリクエストがキャンセルされる
- [ ] 停止時点までの結果が保存される

#### 3.1.4 調査一時停止・再開機能
- [ ] 調査を一時停止できる
- [ ] 一時停止した調査を再開できる
- [ ] 一時停止中は新しいリクエストが開始されない
- [ ] 再開時に正しく続きから処理される

#### 3.1.5 調査結果表示機能
- [ ] 調査結果一覧が正しく表示される
- [ ] リンク切れのURLが正しく表示される
- [ ] HTTPステータスコードが正しく表示される
- [ ] リンク元のURLが正しく表示される
- [ ] アンカーテキストが正しく表示される
- [ ] 調査結果詳細が正しく表示される

#### 3.1.6 フィルタリング機能
- [ ] HTTPステータスコードでフィルタリングできる
- [ ] リンク切れのみを表示できる
- [ ] フィルタリング後の結果が正しく表示される

#### 3.1.7 検索機能
- [ ] URLで検索できる
- [ ] 検索結果が正しく表示される
- [ ] 検索結果が0件の場合、適切なメッセージが表示される

#### 3.1.8 設定機能
- [ ] 設定を変更できる
- [ ] 設定を保存できる
- [ ] 保存した設定が読み込まれる
- [ ] 設定のバリデーションが正しく動作する

#### 3.1.9 履歴機能
- [ ] 調査履歴一覧が表示される
- [ ] 履歴を選択して結果を表示できる
- [ ] 履歴が正しく保存される

#### 3.1.10 エクスポート機能
- [ ] 調査結果をCSV形式でエクスポートできる
- [ ] エクスポートされたCSVファイルが正しい形式である
- [ ] エクスポートされたCSVファイルにすべての結果が含まれている

### 3.2 非機能テスト項目

#### 3.2.1 パフォーマンス
- [ ] 1000ページの調査が10分以内に完了する
- [ ] 10000ページの調査が2時間以内に完了する
- [ ] 大量データの検索・フィルタリングが3秒以内に完了する
- [ ] UIがフリーズしない

#### 3.2.2 セキュリティ
- [ ] SQLインジェクション攻撃を防げる
- [ ] XSS攻撃を防げる
- [ ] パストラバーサル攻撃を防げる
- [ ] 無効なURL入力を適切に処理できる

#### 3.2.3 エラーハンドリング
- [ ] ネットワークエラーが適切に処理される
- [ ] タイムアウトが適切に処理される
- [ ] HTTPエラーが適切に処理される
- [ ] データベースエラーが適切に処理される
- [ ] エラーメッセージが分かりやすい

#### 3.2.4 可用性
- [ ] アプリケーションが正常に起動する
- [ ] アプリケーションが正常に終了する
- [ ] 予期しないエラーが発生してもアプリケーションがクラッシュしない

### 3.3 回帰テスト項目

#### 3.3.1 既存機能の確認
- [ ] 既存の機能が正しく動作する
- [ ] 既存の機能に影響がない
- [ ] 既存のデータが正しく読み込まれる

### 3.4 テストケース

詳細なテストケースは、各テスト種別ごとに別ファイルとして管理します。

#### 3.4.1 単体テストケース例

**LinkChecker.checkLink()のテストケース**

1. **正常なURL（200 OK）**
   - 入力: `https://example.com`
   - 期待結果: `isBroken: false, httpStatusCode: 200`

2. **リンク切れ（404 Not Found）**
   - 入力: `https://example.com/notfound`
   - 期待結果: `isBroken: true, httpStatusCode: 404`

3. **サーバーエラー（500）**
   - 入力: `https://example.com/error`
   - 期待結果: `isBroken: true, httpStatusCode: 500`

4. **タイムアウト**
   - 入力: `https://slow-site.com`
   - 期待結果: `isBroken: true, errorMessage: "Timeout"`

5. **ネットワークエラー**
   - 入力: `https://invalid-domain-12345.com`
   - 期待結果: `isBroken: true, errorMessage: "Network error"`

**URL正規化ロジックのテストケース**

1. **絶対URL**
   - 入力: `https://example.com/page`
   - 期待結果: `https://example.com/page`

2. **相対URL（パス）**
   - 入力: `baseUrl: https://example.com/, url: /page`
   - 期待結果: `https://example.com/page`

3. **相対URL（相対パス）**
   - 入力: `baseUrl: https://example.com/dir/, url: ../page`
   - 期待結果: `https://example.com/page`

4. **フラグメント付きURL**
   - 入力: `https://example.com/page#section`
   - 期待結果: `https://example.com/page`（フラグメントを削除）

#### 3.4.2 結合テストケース例

**シナリオ1: 調査開始から完了までのフロー**

1. メイン画面でURLを入力
2. 調査開始ボタンをクリック
3. 調査が開始されることを確認
4. 進捗が更新されることを確認
5. 調査結果がデータベースに保存されることを確認
6. 調査結果一覧画面に結果が表示されることを確認

**シナリオ2: 調査の一時停止・再開**

1. 調査を開始
2. 一時停止ボタンをクリック
3. 調査が一時停止されることを確認
4. 再開ボタンをクリック
5. 調査が再開されることを確認

**シナリオ3: 調査結果のフィルタリング・検索**

1. 調査結果一覧画面を表示
2. フィルタを設定（404エラーのみ）
3. フィルタリング後の結果が表示されることを確認
4. 検索を実行
5. 検索結果が表示されることを確認

**シナリオ4: 設定の保存・読み込み**

1. 設定画面で設定を変更
2. 保存ボタンをクリック
3. 設定が保存されることを確認
4. アプリケーションを再起動
5. 設定が読み込まれることを確認

## 4. テスト環境

### 4.1 テスト環境構成

```
┌─────────────────────────────────────────┐
│         テスト実行環境                   │
├─────────────────────────────────────────┤
│  OS: Windows 10/11                      │
│  Node.js: 最新のLTSバージョン            │
│  Electron: 最新バージョン               │
├─────────────────────────────────────────┤
│  テストフレームワーク                   │
│  - Jest（単体テスト・結合テスト）        │
│  - Playwright または Spectron（E2E）     │
├─────────────────────────────────────────┤
│  テストデータベース                      │
│  - SQLite（テスト用ファイル）            │
├─────────────────────────────────────────┤
│  モックサーバー                          │
│  - テスト用HTTPサーバー                  │
│  - 様々なレスポンスを返すエンドポイント  │
└─────────────────────────────────────────┘
```

### 4.2 ハードウェア環境

- **OS**: Windows 10/11
- **CPU**: 2コア以上推奨
- **メモリ**: 4GB以上推奨
- **ストレージ**: 1GB以上の空き容量

### 4.3 ソフトウェア環境

- **Node.js**: 最新のLTSバージョン
- **Electron**: 最新バージョン
- **npm**: Node.jsに含まれる
- **テストフレームワーク**: Jest
- **E2Eテスト**: Playwright または Spectron
- **カバレッジツール**: Jestのカバレッジ機能

### 4.4 テストデータ

#### テストデータ要件

- **多様なURL**
  - 正常なURL（200 OK）
  - リンク切れURL（404, 500など）
  - リダイレクトURL（301, 302）
  - タイムアウトするURL
  - ネットワークエラーが発生するURL
- **多様なHTML**
  - 通常のHTML
  - リンクが多数含まれるHTML
  - 相対URLのみのHTML
  - 外部リンクを含むHTML

#### テストデータ作成方法

- **モックサーバー**
  - テスト用のHTTPサーバーを起動
  - 様々なレスポンスを返すエンドポイントを用意
- **モックデータ**
  - データベースのテストデータを作成
  - テスト用のSQLiteファイルを用意
- **テスト用URL**
  - テスト用のWebサイトを用意
  - または、モックサーバーを使用

#### テストデータ管理

- **テストデータファイル**: `tests/fixtures/`ディレクトリに保存
  - HTMLファイル
  - JSONファイル
- **テストデータベース**: テスト用のSQLiteファイルを用意
- **テストデータのリセット**: 各テスト実行前にデータをリセット

### 4.5 テストツール

- **Jest**: 単体テスト・結合テストフレームワーク
- **Playwright または Spectron**: E2Eテストフレームワーク
- **Chrome DevTools**: プロファイリングツール
- **Node.js Profiler**: パフォーマンス測定ツール

## 5. スケジュール

### 5.1 テスト実施スケジュール

#### フェーズ1: 単体テスト（実装フェーズと並行）
- **期間**: 実装フェーズ全体
- **内容**: 各機能の実装と同時に単体テストを実施
- **目標**: カバレッジ80%以上（ビジネスロジック90%以上）

#### フェーズ2: 結合テスト（実装フェーズ後半）
- **期間**: 実装フェーズ後半
- **内容**: 複数のコンポーネントの連携テスト
- **目標**: すべての結合テストシナリオがパス

#### フェーズ3: システムテスト（実装フェーズ完了後）
- **期間**: 実装フェーズ完了後、1週間
- **内容**: システム全体の機能テスト
- **目標**: すべての機能が正常に動作

#### フェーズ4: E2Eテスト（システムテスト後）
- **期間**: システムテスト後、1週間
- **内容**: エンドツーエンドのテスト
- **目標**: すべてのE2Eテストシナリオがパス

#### フェーズ5: パフォーマンステスト・セキュリティテスト（E2Eテスト後）
- **期間**: E2Eテスト後、1週間
- **内容**: パフォーマンステスト、セキュリティテスト
- **目標**: パフォーマンス要件・セキュリティ要件を満たす

#### フェーズ6: ユーザビリティテスト（パフォーマンステスト後）
- **期間**: パフォーマンステスト後、1週間
- **内容**: UIの使いやすさの確認
- **目標**: UIが直感的に操作できる

### 5.2 マイルストーン

- **M1: 単体テスト完了**（実装フェーズ完了時）
  - カバレッジ80%以上達成
  - すべての単体テストがパス
- **M2: 結合テスト完了**（実装フェーズ完了時）
  - すべての結合テストがパス
- **M3: システムテスト完了**（実装フェーズ完了後1週間）
  - すべての機能が正常に動作
- **M4: E2Eテスト完了**（システムテスト後1週間）
  - すべてのE2Eテストがパス
- **M5: パフォーマンステスト・セキュリティテスト完了**（E2Eテスト後1週間）
  - パフォーマンス要件・セキュリティ要件を満たす
- **M6: ユーザビリティテスト完了**（パフォーマンステスト後1週間）
  - UIが直感的に操作できる

### 5.3 リソース計画

- **テスト担当者**: 開発者（実装と並行してテストを実施）
- **テスト環境**: 開発環境と同一
- **テストツール**: オープンソースツールを使用（コストなし）

## 6. テスト実施体制

### 6.1 テストチーム構成

- **開発者**: 実装と並行して単体テスト・結合テストを実施
- **プロジェクトリーダー**: テスト計画の策定、テスト結果の確認

### 6.2 役割分担

- **開発者**
  - 単体テストの作成・実行
  - 結合テストの作成・実行
  - バグの修正
- **プロジェクトリーダー**
  - テスト計画の策定
  - テスト結果の確認
  - テスト完了の判断

### 6.3 コミュニケーション体制

- **日次**: テスト進捗の報告
- **週次**: テスト結果のレビュー
- **問題発生時**: 即座に報告・対応

## 7. テスト結果管理

### 7.1 テスト結果の記録方法

- **テスト結果ファイル**: `tests/results/`ディレクトリに保存
- **テストレポート**: Jestのレポート機能を使用
- **カバレッジレポート**: Jestのカバレッジレポートを生成

### 7.2 バグ管理

- **バグ管理ツール**: GitHub Issues
- **バグの優先度**: 高、中、低
- **バグの修正**: 優先度に応じて対応

### 7.3 テスト進捗管理

- **テスト進捗**: テスト項目のチェックリストで管理
- **進捗報告**: 週次で進捗を報告

### 7.4 テスト報告

- **テスト報告書**: 各フェーズ完了時に作成
- **報告内容**: テスト結果、発見されたバグ、カバレッジ、次のステップ

## 8. リスク管理

### 8.1 テストリスク

#### リスク1: テスト環境の不備
- **内容**: テスト環境が正しく構築されていない
- **影響**: テストが実行できない
- **対策**: テスト環境の構築を早期に実施、CI/CDで自動化

#### リスク2: テストデータの不足
- **内容**: テストデータが不足している
- **影響**: 十分なテストが実施できない
- **対策**: テストデータを事前に準備、モックサーバーを使用

#### リスク3: テスト時間の不足
- **内容**: テストに十分な時間が確保できない
- **影響**: テストが不十分になる
- **対策**: テストを自動化、優先度の高いテストから実施

#### リスク4: バグの修正が遅れる
- **内容**: 発見されたバグの修正が遅れる
- **影響**: テストが進まない
- **対策**: バグの優先度を明確化、早期に修正

### 8.2 リスク対策

- **テスト環境の早期構築**: 実装フェーズ開始前にテスト環境を構築
- **テストデータの事前準備**: テストデータを事前に準備
- **テストの自動化**: 可能な限りテストを自動化
- **バグの優先度管理**: バグの優先度を明確化し、早期に修正

### 8.3 エスカレーション

- **重大なバグ発見時**: 即座にプロジェクトリーダーに報告
- **テストが進まない場合**: プロジェクトリーダーに相談
- **リソース不足**: プロジェクトリーダーに相談

## 9. 品質基準

### 9.1 テスト完了基準

以下の条件をすべて満たした場合、テストを完了とします：

1. **単体テスト**
   - すべての単体テストがパス
   - カバレッジが目標値（80%以上、ビジネスロジック90%以上）を達成

2. **結合テスト**
   - すべての結合テストがパス
   - データの整合性が保たれている

3. **システムテスト**
   - すべての機能が正常に動作
   - エラーが発生しない

4. **E2Eテスト**
   - すべてのE2Eテストがパス
   - UIが正しく表示される

5. **パフォーマンステスト**
   - パフォーマンス要件を満たしている
   - メモリリークが発生していない

6. **セキュリティテスト**
   - セキュリティ要件を満たしている
   - 既知の脆弱性が存在しない

7. **ユーザビリティテスト**
   - UIが直感的に操作できる
   - エラーメッセージが分かりやすい

8. **バグ管理**
   - 高優先度のバグがすべて修正されている
   - 中優先度のバグはリリース後に修正可能なもののみ残す

### 9.2 品質目標

- **カバレッジ**: 80%以上（ビジネスロジック90%以上）
- **バグ密度**: 1000行あたり1件以下
- **パフォーマンス**: 1000ページの調査が10分以内に完了
- **セキュリティ**: 既知の脆弱性が存在しない

### 9.3 品質メトリクス

以下のメトリクスで品質を測定します：

- **テストカバレッジ**: Jestのカバレッジレポート
- **バグ数**: GitHub Issuesで管理
- **テスト実行時間**: CI/CDのログから取得
- **パフォーマンス**: プロファイリングツールで測定

