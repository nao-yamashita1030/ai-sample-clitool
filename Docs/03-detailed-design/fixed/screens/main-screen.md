# 画面詳細設計: メイン画面

## 基本情報

- **画面名**: メイン画面
- **画面ID**: SCREEN-001
- **URL**: `/`（ルート）
- **説明**: URLを入力してリンク切れ調査を開始する画面
- **対象ユーザー**: すべてのユーザー

## 画面の目的

- URLを入力してリンク切れ調査を開始する
- 調査の進捗状況を表示する
- 設定画面や調査履歴画面への遷移を提供する

## レイアウト

### 画面構成

```
┌─────────────────────────────────────────┐
│           ヘッダー（アプリ名）            │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐  │
│  │  URL入力エリア                   │  │
│  │  [URL入力フィールド]              │  │
│  │  [調査開始ボタン]                 │  │
│  └─────────────────────────────────┘  │
│                                         │
│  ┌─────────────────────────────────┐  │
│  │  進捗表示エリア（調査中の場合）    │  │
│  │  [プログレスバー]                 │  │
│  │  [進捗テキスト]                   │  │
│  │  [一時停止/再開ボタン]             │  │
│  │  [停止ボタン]                     │  │
│  └─────────────────────────────────┘  │
│                                         │
│  ┌─────────────────────────────────┐  │
│  │  ナビゲーション                  │  │
│  │  [設定] [調査履歴]               │  │
│  └─────────────────────────────────┘  │
│                                         │
└─────────────────────────────────────────┘
```

### レイアウト説明

- **ヘッダー**: アプリケーション名を表示
- **URL入力エリア**: URL入力フィールドと調査開始ボタン
- **進捗表示エリア**: 調査中の場合のみ表示、プログレスバーと制御ボタン
- **ナビゲーション**: 設定画面と調査履歴画面へのリンク

## 画面要素

### 要素1: URL入力フィールド

- **要素名**: URL入力フィールド
- **種類**: テキスト入力欄
- **位置**: 画面中央上部
- **説明**: 調査を開始するURLを入力する
- **初期値**: 空文字列
- **必須/任意**: 必須
- **プレースホルダー**: "https://example.com"
- **バリデーション**: 
  - URL形式チェック
  - http/httpsプロトコルチェック

### 要素2: 調査開始ボタン

- **要素名**: 調査開始ボタン
- **種類**: ボタン
- **位置**: URL入力フィールドの右側
- **説明**: リンク切れ調査を開始する
- **初期状態**: 有効
- **無効化条件**: 
  - URLが無効な場合
  - 既に調査が実行中の場合

### 要素3: プログレスバー

- **要素名**: プログレスバー
- **種類**: プログレスバー
- **位置**: 進捗表示エリア内
- **説明**: 調査の進捗状況を視覚的に表示
- **表示条件**: 調査が実行中の場合のみ表示
- **値**: 0-100（%）

### 要素4: 進捗テキスト

- **要素名**: 進捗テキスト
- **種類**: テキスト
- **位置**: プログレスバーの下
- **説明**: 進捗状況をテキストで表示（例: "50/100ページ調査済み"）
- **表示条件**: 調査が実行中の場合のみ表示

### 要素5: 一時停止ボタン

- **要素名**: 一時停止ボタン
- **種類**: ボタン
- **位置**: 進捗表示エリア内
- **説明**: 調査を一時停止する
- **表示条件**: 調査が実行中の場合のみ表示
- **状態**: 
  - 実行中: "一時停止"
  - 一時停止中: "再開"

### 要素6: 停止ボタン

- **要素名**: 停止ボタン
- **種類**: ボタン
- **位置**: 進捗表示エリア内
- **説明**: 調査を停止する
- **表示条件**: 調査が実行中または一時停止中の場合のみ表示

### 要素7: 設定リンク

- **要素名**: 設定リンク
- **種類**: リンク/ボタン
- **位置**: ナビゲーションエリア
- **説明**: 設定画面に遷移する

### 要素8: 調査履歴リンク

- **要素名**: 調査履歴リンク
- **種類**: リンク/ボタン
- **位置**: ナビゲーションエリア
- **説明**: 調査履歴画面に遷移する

## バリデーション

### 入力バリデーション

| 項目名 | バリデーション内容 | エラーメッセージ |
|-------|------------------|----------------|
| URL | URL形式が正しいか | "URL形式が正しくありません" |
| URL | プロトコルがhttp/httpsか | "httpまたはhttpsのURLを入力してください" |
| URL | ドメイン部分が存在するか | "ドメインが正しくありません" |
| URL | URLの長さが2048文字以内か | "URLが長すぎます（最大2048文字）" |

### ビジネスルールバリデーション

- 既に調査が実行中の場合は、新しい調査を開始できない
- URLが無効な場合は、調査開始ボタンを無効化

## エラーハンドリング

### エラー表示方法

- エラーメッセージはURL入力フィールドの下に赤色で表示
- モーダルダイアログで重大なエラーを表示

### エラーメッセージ

| エラーコード | エラーメッセージ | 表示位置 |
|------------|----------------|---------|
| INVALID_URL | "無効なURLです" | URL入力フィールドの下 |
| ALREADY_RUNNING | "既に調査が実行中です" | モーダルダイアログ |
| NETWORK_ERROR | "ネットワークエラーが発生しました" | モーダルダイアログ |
| DATABASE_ERROR | "データベースエラーが発生しました" | モーダルダイアログ |

## 画面遷移

### 遷移元

- なし（アプリケーション起動時の初期画面）

### 遷移先

- この画面 → [調査結果一覧画面](./results-list-screen.md)（調査開始後）
- この画面 → [設定画面](./settings-screen.md)（設定リンククリック）
- この画面 → [調査履歴画面](./history-screen.md)（調査履歴リンククリック）

## 処理フロー

1. 画面表示時
   - URL入力フィールドをフォーカス
   - 設定を読み込んでデフォルト値を設定
2. URL入力時
   - リアルタイムでURLバリデーション
   - バリデーション結果に応じて調査開始ボタンの有効/無効を切り替え
3. 調査開始ボタンクリック時
   - URLの最終バリデーション
   - `ipc:start-scan` APIを呼び出し
   - 調査結果一覧画面に遷移
4. 進捗更新時（`ipc:scan-progress`イベント）
   - プログレスバーを更新
   - 進捗テキストを更新
5. 一時停止ボタンクリック時
   - `ipc:pause-scan` APIを呼び出し
   - ボタンのテキストを"再開"に変更
6. 再開ボタンクリック時
   - `ipc:resume-scan` APIを呼び出し
   - ボタンのテキストを"一時停止"に変更
7. 停止ボタンクリック時
   - 確認ダイアログを表示
   - 確認後、`ipc:stop-scan` APIを呼び出し

## 状態管理

### 画面状態

- `url: string` - 入力されたURL
- `isValidUrl: boolean` - URLが有効かどうか
- `isScanning: boolean` - 調査が実行中かどうか
- `scanHistoryId: number | null` - 現在の調査履歴ID
- `progress: Progress | null` - 進捗情報

### データ取得

- 設定取得: `ipc:get-settings` API
- 調査開始: `ipc:start-scan` API
- 進捗取得: `ipc:scan-progress` イベント

## アクセシビリティ

### キーボード操作

- Tabキーで要素間を移動
- Enterキーで調査開始ボタンを実行
- Escキーでモーダルダイアログを閉じる

### スクリーンリーダー対応

- すべての要素に適切なaria-labelを設定
- エラーメッセージにaria-live属性を設定

## 注意事項

- 調査中はURL入力フィールドと調査開始ボタンを無効化
- 進捗表示はリアルタイムで更新（1秒ごと）
- 調査開始後は自動的に調査結果一覧画面に遷移

## 関連画面

- [調査結果一覧画面](./results-list-screen.md)
- [設定画面](./settings-screen.md)
- [調査履歴画面](./history-screen.md)

