# テスト設計

## 10.1 単体テスト設計

### テスト対象

- **ビジネスロジック**: 
  - LinkCheckerクラス（リンクチェック、リンク抽出）
  - URL正規化ロジック
  - リンク切れ判定ロジック
  - URLフィルタリングロジック
  - 進捗計算ロジック
  - 統計情報計算ロジック
- **データアクセス層**: 
  - ScanHistoryModel
  - LinkCheckResultModel
  - SettingsModel
- **ユーティリティ**: 
  - URLバリデーション
  - エラーハンドリング

### テストカバレッジ目標

- **カバレッジ目標**: 80%以上
- **優先度**: 
  - ビジネスロジック: 90%以上
  - データアクセス層: 80%以上
  - UIコンポーネント: 70%以上

### テストケース例

#### LinkChecker.checkLink()のテストケース

1. **正常なURL（200 OK）**: 
   - 入力: `https://example.com`
   - 期待結果: `isBroken: false, httpStatusCode: 200`
2. **リンク切れ（404 Not Found）**: 
   - 入力: `https://example.com/notfound`
   - 期待結果: `isBroken: true, httpStatusCode: 404`
3. **サーバーエラー（500）**: 
   - 入力: `https://example.com/error`
   - 期待結果: `isBroken: true, httpStatusCode: 500`
4. **タイムアウト**: 
   - 入力: `https://slow-site.com`
   - 期待結果: `isBroken: true, errorMessage: "Timeout"`
5. **ネットワークエラー**: 
   - 入力: `https://invalid-domain-12345.com`
   - 期待結果: `isBroken: true, errorMessage: "Network error"`

#### URL正規化ロジックのテストケース

1. **絶対URL**: 
   - 入力: `https://example.com/page`
   - 期待結果: `https://example.com/page`
2. **相対URL（パス）**: 
   - 入力: `baseUrl: https://example.com/, url: /page`
   - 期待結果: `https://example.com/page`
3. **相対URL（相対パス）**: 
   - 入力: `baseUrl: https://example.com/dir/, url: ../page`
   - 期待結果: `https://example.com/page`
4. **フラグメント付きURL**: 
   - 入力: `https://example.com/page#section`
   - 期待結果: `https://example.com/page`（フラグメントを削除）

## 10.2 結合テスト設計

### テスト対象

- **IPC通信**: 
  - レンダラープロセスとメインプロセス間の通信
  - 各IPC APIの動作確認
- **データベース連携**: 
  - データの保存・取得
  - トランザクション処理
- **HTTP通信**: 
  - 外部サイトへのリクエスト
  - エラーハンドリング

### テストシナリオ

#### シナリオ1: 調査開始から完了までのフロー

1. メイン画面でURLを入力
2. 調査開始ボタンをクリック
3. 調査が開始されることを確認
4. 進捗が更新されることを確認
5. 調査結果がデータベースに保存されることを確認
6. 調査結果一覧画面に結果が表示されることを確認

#### シナリオ2: 調査の一時停止・再開

1. 調査を開始
2. 一時停止ボタンをクリック
3. 調査が一時停止されることを確認
4. 再開ボタンをクリック
5. 調査が再開されることを確認

#### シナリオ3: 調査結果のフィルタリング・検索

1. 調査結果一覧画面を表示
2. フィルタを設定（404エラーのみ）
3. フィルタリング後の結果が表示されることを確認
4. 検索を実行
5. 検索結果が表示されることを確認

#### シナリオ4: 設定の保存・読み込み

1. 設定画面で設定を変更
2. 保存ボタンをクリック
3. 設定が保存されることを確認
4. アプリケーションを再起動
5. 設定が読み込まれることを確認

## 10.3 テストデータ設計

### テストデータ要件

- **多様なURL**: 
  - 正常なURL（200 OK）
  - リンク切れURL（404, 500など）
  - リダイレクトURL（301, 302）
  - タイムアウトするURL
  - ネットワークエラーが発生するURL
- **多様なHTML**: 
  - 通常のHTML
  - リンクが多数含まれるHTML
  - 相対URLのみのHTML
  - 外部リンクを含むHTML

### テストデータ作成方法

- **モックサーバー**: 
  - テスト用のHTTPサーバーを起動
  - 様々なレスポンスを返すエンドポイントを用意
- **モックデータ**: 
  - データベースのテストデータを作成
  - テスト用のSQLiteファイルを用意
- **テスト用URL**: 
  - テスト用のWebサイトを用意
  - または、モックサーバーを使用

### テストデータ管理

- **テストデータファイル**: 
  - `tests/fixtures/`ディレクトリに保存
  - HTMLファイル、JSONファイルなど
- **テストデータベース**: 
  - テスト用のSQLiteファイルを用意
  - テスト実行前に初期化
- **テストデータのリセット**: 
  - 各テスト実行前にデータをリセット
  - テスト実行後にクリーンアップ

## 10.4 E2Eテスト設計

### テスト対象

- **主要なユーザーフロー**: 
  - URL入力 → 調査開始 → 結果表示
  - 設定変更 → 保存
  - 履歴選択 → 結果表示

### テストツール

- **Electron + Playwright**: ElectronアプリケーションのE2Eテスト
- **または**: Spectron（Electron用のE2Eテストフレームワーク）

### テストシナリオ

1. **アプリケーション起動**: アプリケーションが正常に起動することを確認
2. **URL入力・調査開始**: URLを入力して調査を開始し、結果が表示されることを確認
3. **設定変更**: 設定を変更して保存し、設定が反映されることを確認
4. **履歴表示**: 調査履歴を表示し、過去の結果が表示されることを確認

## 10.5 パフォーマンステスト設計

### テスト対象

- **調査処理**: 大量のURLを調査した場合のパフォーマンス
- **データベースクエリ**: 大量データの検索・フィルタリング
- **UI応答性**: 大量データの表示時のUI応答性

### テスト方法

- **負荷テスト**: 1000ページ、10000ページなど、様々な規模でテスト
- **パフォーマンス測定**: 処理時間、メモリ使用量を測定
- **ボトルネック特定**: プロファイリングツールを使用

## 10.6 テスト実行環境

### テスト環境

- **OS**: Windows 10/11
- **Node.js**: 最新のLTSバージョン
- **テストフレームワーク**: Jest
- **E2Eテスト**: Playwright または Spectron

### テスト実行方法

- **単体テスト**: `npm test`
- **結合テスト**: `npm run test:integration`
- **E2Eテスト**: `npm run test:e2e`
- **カバレッジ**: `npm run test:coverage`

## 10.7 テスト自動化

### CI/CD統合

- **GitHub Actions**: プルリクエスト時に自動テスト実行
- **テスト結果**: テスト結果をGitHubに表示
- **カバレッジレポート**: カバレッジレポートを生成

### テスト実行タイミング

- **コミット時**: 単体テストを実行
- **プルリクエスト時**: すべてのテストを実行
- **リリース前**: すべてのテスト + E2Eテストを実行

